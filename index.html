<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

/* BASE */

body{
  font-family:system-ui,-apple-system,sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}

.container{
  width:100%;
  padding:0 16px;
  box-sizing:border-box;
}

/* UPCOMING BAR */

.upcoming-wrapper{
  background:white;
  border-radius:14px;
  padding:10px 12px 6px;
  margin-bottom:14px;
  box-shadow:0 4px 14px rgba(0,0,0,.06);
  position:sticky;
  top:6px;
  z-index:5;
  transition:all .28s cubic-bezier(.4,0,.2,1);
}

/* FILTER BAR */

.filters{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding:8px 2px 4px;
  position:relative;
}
.filters::-webkit-scrollbar{ display:none; }

.filters::after{
  content:"";
  position:absolute;
  right:0;
  top:0;
  bottom:0;
  width:34px;
  pointer-events:none;
  background:linear-gradient(to left, white, transparent);
  opacity:var(--fade,1);
}

.filter-btn{
  border:none;
  background:#eee;
  padding:8px 14px;
  border-radius:999px;
  font-size:13px;
  cursor:pointer;
  white-space:nowrap;
}

.filter-btn.active{
  background:#111;
  color:white;
}

/* UPCOMING SCROLL */

#upcoming-bar{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding-bottom:6px;
}
#upcoming-bar::-webkit-scrollbar{ display:none; }

/* DATE PILLS */

.up-event{
  min-width:60px;
  border-radius:12px;
  background:#111;
  color:white;
  text-align:center;
  padding:8px 4px;
  cursor:pointer;
  transition:.18s;
}

.up-event.active{
  background:#ffd000;
  color:black;
}

.up-date{
  font-size:16px;
  font-weight:800;
}
.up-month{
  font-size:10px;
}

/* CARDS */

.card{
  background:white;
  border-radius:16px;
  overflow:hidden;
  margin-bottom:20px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  display:flex;
  flex-direction:column;
  max-width:520px;
}

.img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}

.content{
  padding:20px;
  display:flex;
  flex-direction:column;
  flex:1;
}

.title{
  font-size:22px;
  font-weight:700;
  margin-bottom:10px;
}

.meta{
  color:#666;
  font-size:14px;
}

.btn{
  margin-top:auto;
  padding:12px;
  background:black;
  color:white;
  border-radius:10px;
  text-decoration:none;
  text-align:center;
}

.month-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(420px,520px));
  gap:32px;
}

.month-title{
  font-size:28px;
  margin:50px 0 20px;
  font-weight:800;
}

@media(max-width:600px){
  .month-grid{display:block;}
}

</style>
</head>

<body>

<div class="upcoming-wrapper">
  <div style="font-weight:700;margin-bottom:6px;">Upcoming Events</div>
  <div id="upcoming-bar"></div>
  <div class="filters" id="filters"></div>
</div>

<div class="container" id="events">Loading events...</div>

<script>

fetch("https://fienta.com/api/v1/public/events?organizer=27119")
.then(r=>r.json())
.then(data=>{

const container=document.getElementById("events");
const upcomingBar=document.getElementById("upcoming-bar");
const filtersBar=document.getElementById("filters");

const events=data.events.sort((a,b)=>new Date(a.starts_at)-new Date(b.starts_at));

/* CATEGORY */

function detectCategory(ev){
  const t=(ev.title+" "+(ev.venue||"")).toLowerCase();
  if(t.includes("workshop")) return "workshop";
  if(t.includes("improv")) return "improv";
  if(t.includes("comedy")) return "comedy";
  return "other";
}
events.forEach(e=>e.category=detectCategory(e));

/* FILTERS */

const counts={};
events.forEach(e=>counts[e.category]=(counts[e.category]||0)+1);
const categories=["all",...Object.keys(counts)];

filtersBar.innerHTML=categories.map(cat=>{
  const label=cat==="all"?"All":cat[0].toUpperCase()+cat.slice(1);
  const count=cat==="all"?events.length:counts[cat];
  return `<button class="filter-btn ${cat==="all"?"active":""}" data-filter="${cat}">
            ${label} (${count})
          </button>`;
}).join("");

requestAnimationFrame(()=>{
  if(filtersBar.scrollWidth<=filtersBar.clientWidth)
    filtersBar.style.setProperty("--fade","0");
});

/* UPCOMING BUILDER */

function buildUpcoming(list){

upcomingBar.innerHTML="";

const map=new Map();

list.forEach(ev=>{
  const d=new Date(ev.starts_at);
  if(d>new Date()){
    const key=d.toDateString();
    if(!map.has(key)) map.set(key,ev);
  }
});

const upcoming=[...map.values()].slice(0,21);

let first=true;

const today=new Date(); today.setHours(0,0,0,0);
const tomorrow=new Date(today); tomorrow.setDate(today.getDate()+1);

upcoming.forEach(ev=>{

  const d=new Date(ev.starts_at);
  const day=new Date(d); day.setHours(0,0,0,0);

  const box=document.createElement("div");
  box.className="up-event";

  let top=d.toLocaleString("default",{weekday:"short"});
  let mid=d.getDate();
  let bot=d.toLocaleString("default",{month:"short"});

  if(day.getTime()===today.getTime()) top="Today";
  else if(day.getTime()===tomorrow.getTime()) top="Tomorrow";

  if(first){
    box.classList.add("active");
    first=false;
  }

  box.innerHTML=`
    <div style="font-size:11px;opacity:.7">${top}</div>
    <div class="up-date">${mid}</div>
    <div class="up-month">${bot}</div>
  `;

  box.onclick=()=>{
    document.querySelectorAll(".up-event").forEach(e=>e.classList.remove("active"));
    box.classList.add("active");

    const el=document.querySelector(`[data-id="${ev.id}"]`);
    if(el){
      const offset=document.querySelector(".upcoming-wrapper").offsetHeight+10;
      const y=el.getBoundingClientRect().top+window.scrollY-offset;
      window.scrollTo({top:y,behavior:"smooth"});
    }
  };

  upcomingBar.appendChild(box);
});
}

/* INITIAL BUILD */
buildUpcoming(events);

/* FILTER CLICK */

filtersBar.onclick=e=>{
  if(!e.target.classList.contains("filter-btn")) return;

  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");

  const f=e.target.dataset.filter;

  const filtered = f==="all"
    ? events
    : events.filter(ev=>ev.category===f);

  buildUpcoming(filtered);

  document.querySelectorAll(".card").forEach(card=>{
    const show=f==="all"||card.dataset.category===f;
    card.style.display=show?"":"none";
  });

  document.querySelectorAll(".month-section").forEach(section=>{
    const visible=[...section.querySelectorAll(".card")]
      .some(c=>c.style.display!=="none");
    section.style.display=visible?"":"none";
  });
};

/* GROUP BY MONTH */

const grouped={};

events.forEach(ev=>{
  const d=new Date(ev.starts_at);
  const key=d.toLocaleString("default",{month:"long",year:"numeric"});
  if(!grouped[key]) grouped[key]=[];
  grouped[key].push(ev);
});

container.innerHTML="";

Object.keys(grouped).forEach(month=>{

  const section=document.createElement("div");
  section.className="month-section";

  section.innerHTML=`<h2 class="month-title">${month}</h2><div class="month-grid"></div>`;
  container.appendChild(section);

  const grid=section.querySelector(".month-grid");

  grouped[month].forEach(ev=>{

    const start=new Date(ev.starts_at);

    const date=start.toLocaleString(undefined,{
      weekday:"short",
      day:"numeric",
      month:"short",
      hour:"2-digit",
      minute:"2-digit"
    });

    const card=document.createElement("div");
    card.className="card";
    card.dataset.id=ev.id;
    card.dataset.category=ev.category;

    card.innerHTML=`
      ${ev.image_url?`<img src="${ev.image_url}" class="img">`:""}
      <div class="content">
        <div class="title">${ev.title}</div>
        <div class="meta">${date}</div>
        ${ev.venue?`<div class="meta">${ev.venue}</div>`:""}
        <a href="${ev.buy_tickets_url}" target="_blank" class="btn">View Event</a>
      </div>
    `;

    grid.appendChild(card);
  });
});

});
</script>

</body>
</html>
