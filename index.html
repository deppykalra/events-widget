<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

/* BASE */

body{
  font-family:system-ui,-apple-system,sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}

.container{
  width:100%;
  padding:0 16px;
  box-sizing:border-box;
}

/* UPCOMING BAR */

.upcoming-wrapper{
  background:white;
  border-radius:14px;
  padding:10px 12px 6px;
  margin-bottom:18px;
  box-shadow:0 4px 14px rgba(0,0,0,.06);
  position:sticky;
  top:6px;
  z-index:5;
  transition:all .28s cubic-bezier(.4,0,.2,1);
}

.upcoming-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.upcoming-title{
  font-size:15px;
  font-weight:700;
}

.upcoming-sub{
  font-size:11px;
  color:#888;
}

.upcoming-scroll{
  position:relative;
}

.upcoming-scroll::before,
.upcoming-scroll::after{
  content:"";
  position:absolute;
  top:0;
  bottom:0;
  width:20px;
  pointer-events:none;
  z-index:2;
}

.upcoming-scroll::before{
  left:0;
  background:linear-gradient(to right, white, transparent);
}

.upcoming-scroll::after{
  right:0;
  background:linear-gradient(to left, white, transparent);
}

#upcoming-bar{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding-bottom:6px;
  scroll-snap-type:x mandatory;
}

#upcoming-bar::-webkit-scrollbar{ display:none; }

/* DATE PILLS */

.up-event{
  scroll-snap-align:start;
  min-width:60px;
  border-radius:12px;
  background:#111;
  color:white;
  text-align:center;
  padding:8px 4px;
  cursor:pointer;
  transition:.18s;
  transform:scale(.98);
}

.up-event:active{ transform:scale(.92); }

.up-event.active{
  background:#ffd000;
  color:black;
  transform:scale(1);
}

.up-date{
  font-size:16px;
  font-weight:800;
}

.up-month{
  font-size:10px;
  margin-top:2px;
  opacity:.85;
}

/* CARDS */

.card{
  background:white;
  border-radius:16px;
  overflow:hidden;
  margin-bottom:20px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  transition:.2s;
  display:flex;
  flex-direction:column;
}

.card:hover{
  transform:translateY(-4px);
  box-shadow:0 10px 26px rgba(0,0,0,.12);
}

.img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}

.content{
  padding:20px 20px 18px;
  display:flex;
  flex-direction:column;
  flex:1;
}

.title{
  font-size:22px;
  font-weight:700;
  margin-bottom:10px;
}

.meta{
  color:#666;
  font-size:14px;
  margin-bottom:3px;
}

.price{ font-weight:600; }


.badge{
  display:inline-block;
  padding:4px 8px;
  background:#ff4d4f;
  color:white;
  font-size:12px;
  border-radius:6px;
  margin-top:8px;
}

.btn{
  margin-top:18px;
  display:block;
  text-align:center;
  padding:12px;
  background:black;
  color:white;
  border-radius:10px;
  text-decoration:none;
  font-size:14px;
}

/* MONTHS */

.month-title{
  font-size:28px;
  margin:50px 0 20px;
  font-weight:800;
}

.month-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(420px,1fr));
  gap:32px;
}

.month-section{
  margin-bottom:60px;
}

/* MOBILE */

@media (max-width:600px){

  body{ padding:10px; }

  .month-grid{ display:block; }

  .card{ margin-bottom:22px; }

  .month-title{
    font-size:22px;
    margin:30px 0 14px;
  }

  .upcoming-sub{ display:none; }

  /* SHRINK ONLY MOBILE */

  .upcoming-wrapper.shrink{
    padding:6px 10px 4px;
    border-radius:10px;
    box-shadow:0 2px 10px rgba(0,0,0,.08);
  }

  .upcoming-wrapper.shrink .up-event{
    min-width:54px;
    padding:6px 4px;
  }

  .upcoming-wrapper.shrink .up-date{ font-size:14px; }
  .upcoming-wrapper.shrink .up-month{ font-size:9px; }
}

</style>
</head>

<body>

<div class="upcoming-wrapper">
  <div class="upcoming-header">
    <div class="upcoming-title">Upcoming Events</div>
    <div class="upcoming-sub">Tap a date</div>
  </div>

  <div class="upcoming-scroll">
    <div id="upcoming-bar"></div>
  </div>
</div>

<div class="container" id="events">Loading events...</div>

<script>
fetch("https://fienta.com/api/v1/public/events?organizer=27119")
.then(r=>r.json())
.then(data=>{

const container=document.getElementById("events");
const upcomingBar=document.getElementById("upcoming-bar");

const events=data.events.sort((a,b)=>new Date(a.starts_at)-new Date(b.starts_at));

/* UNIQUE UPCOMING DAYS */

const map=new Map();

events.forEach(ev=>{
  const d=new Date(ev.starts_at);
  if(d>new Date()){
    const key=d.toDateString();
    if(!map.has(key)) map.set(key,ev);
  }
});

const upcoming=[...map.values()].slice(0,21);

let first=true;

upcoming.forEach(ev=>{
  const d=new Date(ev.starts_at);

  const box=document.createElement("div");
  box.className="up-event";

  if(first){
    box.classList.add("active");
    first=false;
  }

  box.innerHTML=`
    <div style="font-size:11px;opacity:.7">
      ${d.toLocaleString("default",{weekday:"short"})}
    </div>
    <div class="up-date">${d.getDate()}</div>
    <div class="up-month">
      ${d.toLocaleString("default",{month:"short"})}
    </div>
  `;

  box.onclick=()=>{
    document.querySelectorAll(".up-event").forEach(e=>e.classList.remove("active"));
    box.classList.add("active");

    const el=document.querySelector(`[data-id="${ev.id}"]`);
    if(el){
      const offset=document.querySelector(".upcoming-wrapper").offsetHeight+10;
      const y=el.getBoundingClientRect().top+window.scrollY-offset;
      window.scrollTo({top:y,behavior:"smooth"});
    }
  };

  upcomingBar.appendChild(box);
});

/* GROUP BY MONTH */

const grouped={};

events.forEach(ev=>{
  const d=new Date(ev.starts_at);
  const key=d.toLocaleString("default",{month:"long",year:"numeric"});
  if(!grouped[key]) grouped[key]=[];
  grouped[key].push(ev);
});

container.innerHTML="";

Object.keys(grouped).forEach(month=>{

  const section=document.createElement("div");
  section.className="month-section";

  section.innerHTML=`
    <h2 class="month-title">${month}</h2>
    <div class="month-grid"></div>
  `;

  container.appendChild(section);
  const grid=section.querySelector(".month-grid");

  grouped[month].forEach(ev=>{

    const start=new Date(ev.starts_at);

    const date=start.toLocaleString(undefined,{
      weekday:"short",
      day:"numeric",
      month:"short",
      hour:"2-digit",
      minute:"2-digit"
    });

    const soldOut=ev.sale_status!=="onSale";

    const card=document.createElement("div");
    card.className="card";
    card.dataset.id=ev.id;

    card.innerHTML=`
      ${ev.image_url?`<img src="${ev.image_url}" class="img">`:""}
      <div class="content">
        <div class="title">${ev.title}</div>
        <div class="meta">${date}</div>
        ${ev.venue?`<div class="meta">${ev.venue}</div>`:""}
        ${soldOut?`<div class="badge">Sold Out</div>`:""}
        <a href="${ev.buy_tickets_url}" target="_blank" class="btn">View Event</a>
      </div>
    `;

    grid.appendChild(card);
  });
});
});
</script>

<script>
const bar=document.querySelector(".upcoming-wrapper");

window.addEventListener("scroll",()=>{
  if(window.innerWidth<=600){
    window.scrollY>60 ? bar.classList.add("shrink")
                      : bar.classList.remove("shrink");
  }
});
</script>

</body>
</html>
